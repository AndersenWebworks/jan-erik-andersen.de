# Apache Configuration for jan-erik-andersen.de
# AI-native website optimization

# ====================================
# 1. HTTPS Redirect
# ====================================
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# ====================================
# 2. WWW Redirect (optional - choose one)
# ====================================
# Option A: Redirect www to non-www (RECOMMENDED)
RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# Option B: Redirect non-www to www (alternative)
# RewriteCond %{HTTP_HOST} !^www\. [NC]
# RewriteRule ^(.*)$ https://www.%{HTTP_HOST}/$1 [R=301,L]

# ====================================
# 3. Content Type Headers
# ====================================
<IfModule mod_headers.c>
    # JSON-LD
    <FilesMatch "\.(jsonld)$">
        Header set Content-Type "application/ld+json; charset=utf-8"
    </FilesMatch>

    # JSON
    <FilesMatch "\.(json)$">
        Header set Content-Type "application/json; charset=utf-8"
    </FilesMatch>

    # Markdown
    <FilesMatch "\.(md)$">
        Header set Content-Type "text/markdown; charset=utf-8"
    </FilesMatch>

    # Security Headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    # CORS f체r AI-Agenten (optional)
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, OPTIONS"
    Header set Access-Control-Allow-Headers "Content-Type"
</IfModule>

# ====================================
# 4. Caching Headers
# ====================================
<IfModule mod_expires.c>
    ExpiresActive On

    # HTML (kurzes Caching, da sich Content 채ndern kann)
    ExpiresByType text/html "access plus 1 hour"

    # JSON/JSON-LD (mittleres Caching)
    ExpiresByType application/json "access plus 1 day"
    ExpiresByType application/ld+json "access plus 1 day"

    # Markdown
    ExpiresByType text/markdown "access plus 1 day"

    # Images (falls sp채ter hinzugef체gt)
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/webp "access plus 1 month"
    ExpiresByType image/svg+xml "access plus 1 month"
</IfModule>

# Cache-Control Headers
<IfModule mod_headers.c>
    # HTML
    <FilesMatch "\.(html)$">
        Header set Cache-Control "max-age=3600, must-revalidate"
    </FilesMatch>

    # JSON/JSON-LD
    <FilesMatch "\.(json|jsonld)$">
        Header set Cache-Control "max-age=86400, public"
    </FilesMatch>
</IfModule>

# ====================================
# 5. Compression (Gzip)
# ====================================
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE application/ld+json
    AddOutputFilterByType DEFLATE text/markdown
</IfModule>

# ====================================
# 6. Character Encoding
# ====================================
AddDefaultCharset UTF-8
<IfModule mod_mime.c>
    AddCharset UTF-8 .html .json .jsonld .md
</IfModule>

# ====================================
# 7. Directory Index
# ====================================
DirectoryIndex index.html

# ====================================
# 8. Error Pages (optional)
# ====================================
# ErrorDocument 404 /404.html
# ErrorDocument 500 /500.html

# ====================================
# 9. File Access Security
# ====================================
# Deny access to sensitive files
<FilesMatch "^(\.gitignore|\.gitattributes|FTP\.md|deploy\.py|README\.md|MARKETING\.md|VISION\.md)$">
    Require all denied
</FilesMatch>

# Deny access to hidden files
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

# ====================================
# 10. Canonical URL (via header)
# ====================================
<IfModule mod_headers.c>
    <Files "index.html">
        Header add Link "<https://jan-erik-andersen.de/>; rel=\"canonical\""
    </Files>
</IfModule>
